<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>グループB：アイデア評価（Backpack例）</title>

  <style>
    :root{
      --bg:#f5f7fb;
      --card:#ffffff;
      --line:#d8e0ee;
      --text:#1f2a44;
      --muted:#5f6f8a;
      --accent:#3b82f6;
      --shadow:0 8px 20px rgba(30,50,90,.12);
      --r:14px;
      --soft:#fbfcff;
      --warn:#fef3c7;
      --warnLine:#fde68a;
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, "Segoe UI",
        "Hiragino Kaku Gothic ProN","Noto Sans JP","Yu Gothic",sans-serif;
      background: linear-gradient(180deg, #f9fbff, var(--bg));
      color:var(--text);
    }

    header{
      position:sticky;
      top:0;
      z-index:10;
      display:flex;
      justify-content:space-between;
      gap:12px;
      padding:16px 18px;
      border-bottom:1px solid var(--line);
      background:#ffffffcc;
      backdrop-filter: blur(6px);
    }
    header h1{ margin:0; font-size:18px; line-height:1.3; }
    .muted{ color:var(--muted); }
    .row{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
    .pill{
      border:1px solid var(--line);
      border-radius:999px;
      padding:8px 10px;
      background:#fff;
      box-shadow:var(--shadow);
      font-size:12px;
    }
    .btn{
      border:1px solid transparent;
      border-radius:10px;
      padding:10px 14px;
      background:linear-gradient(180deg, #60a5fa, #3b82f6);
      color:#fff;
      font-weight:700;
      cursor:pointer;
    }
    .btn:hover{ filter:brightness(1.05); }
    .btn-secondary{
      background:#fff;
      border-color:var(--line);
      color:var(--text);
      font-weight:600;
    }

    main{
      max-width: 1150px;
      margin:0 auto;
      padding:18px;
    }
    .card{
      background:var(--card);
      border:1px solid var(--line);
      border-radius:var(--r);
      padding:16px;
      box-shadow:var(--shadow);
    }
    .card + .card{ margin-top:14px; }

    .notice{
      background: var(--warn);
      border:1px solid var(--warnLine);
      border-radius: 12px;
      padding: 12px 14px;
      font-size: 13px;
      margin-top: 10px;
    }
    .grid2{
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap:14px;
      margin-top:14px;
    }
    @media (max-width:980px){
      .grid2{ grid-template-columns: 1fr; }
      header{ position:static; }
    }

    /* Idea display */
    .ideaBox{
      background:var(--soft);
      border:1px solid var(--line);
      border-radius:12px;
      padding:14px;
    }
    .meta{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      margin-bottom:8px;
      flex-wrap:wrap;
    }
    .tag{
      border:1px solid var(--line);
      border-radius:999px;
      padding:6px 10px;
      background:#fff;
      font-size:12px;
    }
    .ideaTitle{ margin:0 0 8px; font-size:14px; }
    .ideaText{ white-space:pre-wrap; line-height:1.55; font-size:14px; }

    /* Rating table */
    table{
      width:100%;
      border-collapse:separate;
      border-spacing:0;
      overflow:hidden;
      border:1px solid var(--line);
      border-radius:12px;
      background:#fff;
    }
    th, td{
      padding:10px 10px;
      border-bottom:1px solid var(--line);
      vertical-align:middle;
      font-size:13px;
    }
    th{
      text-align:left;
      background: #f3f7ff;
      font-weight:800;
    }
    tr:last-child td{ border-bottom:none; }
    .descSmall{ font-size:12px; color:var(--muted); margin-top:2px; }

    .scale{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      justify-content:flex-start;
    }
    .scale label{
      display:inline-flex;
      gap:6px;
      align-items:center;
      border:1px solid var(--line);
      border-radius:999px;
      padding:6px 10px;
      background:var(--soft);
      cursor:pointer;
      user-select:none;
    }
    .scale input{ accent-color: var(--accent); }

    .actions{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top: 12px;
    }

    /* Pairwise */
    .hidden{ display:none; }
    .pairWrap{
      background:var(--soft);
      border:1px dashed #93c5fd;
      border-radius:12px;
      padding:12px;
    }
    .pairGrid{
      display:grid;
      grid-template-columns: 1fr .8fr 1fr;
      gap:12px;
      align-items:start;
      margin-top:10px;
    }
    @media (max-width:980px){
      .pairGrid{ grid-template-columns:1fr; }
    }
    .pairCard{
      background:#fff;
      border:1px solid var(--line);
      border-radius:12px;
      padding:12px;
    }
    .pairMid{
      background:#fff;
      border:1px solid var(--line);
      border-radius:12px;
      padding:12px;
    }
    .q{ font-size:13px; margin-bottom:10px; }
    .pairBtns{ display:flex; flex-direction:column; gap:10px; }
    .foot{
      margin-top:10px;
      font-size:12px;
      color:var(--muted);
    }

    /* small helper */
    .rightCol h2{ margin:0 0 8px; font-size:15px; }
  </style>
</head>

<body>
  <header>
    <div>
      <h1>評価設計（グループB）/ Evaluation Design（Backpack例）</h1>
      <div class="muted" style="font-size:13px; margin-top:6px;">
        研究参加者は提示されたアイデア内容のみに基づいて評価します（生成条件等は表示しません）。
      </div>
    </div>
    <div class="row">
      <div class="pill">モード：<span id="modeLabel">リッカート評価</span></div>
      <button class="btn btn-secondary" id="toggleModeBtn" type="button">ペア比較へ</button>
    </div>
  </header>

  <main>
    <section class="card">
      <strong>評価指標（5段階リッカート尺度）</strong>
      <div class="muted" style="margin-top:6px; font-size:13px; line-height:1.5;">
        新規性 / 有用性 / 実現可能性 / 明確さ / 総合評価 を 1〜5（1=低い、5=高い）で評価します。
      </div>

      <div class="notice">
        <strong>注意：</strong>
        評価対象はすべて「バックパックの改善アイデア（例）」です。アイデアの由来や提示条件等は表示されません。
      </div>

      <div class="grid2">
        <!-- Left: Idea + Likert -->
        <div>
          <div class="ideaBox">
            <div class="meta">
              <div class="tag">アイデアID：<span id="ideaId"></span></div>
              <div class="tag">進捗：<span id="ideaIdx"></span>/<span id="ideaTotal"></span></div>
            </div>

            <h3 class="ideaTitle">設計解の説明 / Description of the Idea/solution</h3>
            <div class="ideaText" id="ideaText"></div>
          </div>

          <div style="margin-top:14px;">
            <table>
              <thead>
                <tr>
                  <th style="width:28%;">指標</th>
                  <th>評価（1〜5）</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>
                    新規性（Novelty）
                    <div class="descSmall">独創的で意外性があるか</div>
                  </td>
                  <td><div class="scale" data-key="novelty"></div></td>
                </tr>
                <tr>
                  <td>
                    有用性（Usefulness）
                    <div class="descSmall">課題解決に役立つか、価値があるか</div>
                  </td>
                  <td><div class="scale" data-key="usefulness"></div></td>
                </tr>
                <tr>
                  <td>
                    実現可能性（Feasibility）
                    <div class="descSmall">技術・資源的に実装できそうか</div>
                  </td>
                  <td><div class="scale" data-key="feasibility"></div></td>
                </tr>
                <tr>
                  <td>
                    明確さ（Clarity）
                    <div class="descSmall">理解しやすく、伝わりやすいか</div>
                  </td>
                  <td><div class="scale" data-key="clarity"></div></td>
                </tr>
                <tr>
                  <td>
                    総合評価（Overall Quality）
                    <div class="descSmall">4指標を総合した全体印象</div>
                  </td>
                  <td><div class="scale" data-key="overall"></div></td>
                </tr>
              </tbody>
            </table>

            <div class="actions">
              <button class="btn btn-secondary" id="prevIdeaBtn" type="button">前へ</button>
              <button class="btn" id="nextIdeaBtn" type="button">次へ</button>
              <button class="btn btn-secondary" id="saveBtn" type="button">保存（例）</button>
            </div>

            <div class="foot">
              ※保存（例）はデモ表示です。実運用ではサーバ送信やローカル保存等に置き換えてください。
              （このページは審査用の画面例としても利用できます）
            </div>
          </div>
        </div>

        <!-- Right: Pairwise in same page -->
        <div class="rightCol">
          <div id="pairwisePanel" class="pairWrap hidden">
            <h2>信頼性（補足）：ペア比較（例）</h2>
            <div class="muted" style="font-size:13px; line-height:1.5;">
              一部のアイデアペアについて、どちらが<strong>新規性</strong>が高いかを選択します（同程度=も可）。
            </div>

            <div class="pairGrid">
              <div class="pairCard">
                <div class="tag">アイデアA</div>
                <div class="ideaText" id="pairA"></div>
              </div>

              <div class="pairMid">
                <div class="q">質問：どちらがより <strong>新規性</strong> が高いですか？</div>
                <div class="pairBtns">
                  <button class="btn" data-choice="A" type="button">A（&gt;）</button>
                  <button class="btn btn-secondary" data-choice="TIE" type="button">同程度（=）</button>
                  <button class="btn" data-choice="B" type="button">B（&lt;）</button>
                </div>
                <div class="muted small">進捗：<span id="pairIdx"></span>/<span id="pairTotal"></span></div>
              </div>

              <div class="pairCard">
                <div class="tag">アイデアB</div>
                <div class="ideaText" id="pairB"></div>
              </div>
            </div>

            <div class="actions">
              <button class="btn btn-secondary" id="backToLikertBtn" type="button">リッカート評価へ戻る</button>
            </div>

            <div class="foot">
              ※例：10〜15%程度のペア抽出、Bradley–Terryモデル等の利用は研究者側の解析工程です（画面例）。
            </div>
          </div>

          <div id="rightHint" class="pairWrap">
            <h2>ペア比較（任意）</h2>
            <div class="muted" style="font-size:13px; line-height:1.5;">
              右上の「ペア比較へ」から、同一ページ内でペア比較モード（例）を確認できます。
              （審査用の画面例として提示可能）
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <script>
    // ===== Sample ideas: Backpack examples (more examples) =====
    const IDEAS = [
      {
        id: "BP-001",
        text:
`背面パネルを3D立体メッシュ構造にし、背中とバッグの接触面を減らして通気性を向上させる。
長時間の通勤・通学でも蒸れを抑え、快適性を高める。`
      },
      {
        id: "BP-002",
        text:
`肩ベルト内部に荷重分散用の可変テンション機構を組み込み、歩行中の揺れと肩への局所負荷を低減する。
体格に合わせて簡単に調整できる設計とする。`
      },
      {
        id: "BP-003",
        text:
`背負ったまま片手でアクセスできるサイドスライドポケットを追加し、スマホやICカードを素早く取り出せるようにする。
取り出し口には落下防止の返し構造を設ける。`
      },
      {
        id: "BP-004",
        text:
`底面を二層構造（防水層＋耐摩耗層）にし、雨天や床置き時の浸水・汚れを抑える。
濡れた折り畳み傘専用の排水ポケットも追加する。`
      },
      {
        id: "BP-005",
        text:
`内部をモジュール化し、用途別に取り外せるインナーポーチ（PC/書類/ガジェット）を標準化する。
旅行時は必要なモジュールだけを外して持ち運べる。`
      },
      {
        id: "BP-006",
        text:
`開口部をL字ファスナーにし、荷物を縦方向に一気に見渡せる構造に変更する。
整理しやすさを高め、取り出しのストレスを減らす。`
      }
    ];

    // Pairwise samples (例：2ペア)
    const PAIRS = [
      { aId:"BP-001", bId:"BP-003", metric:"novelty" },
      { aId:"BP-002", bId:"BP-005", metric:"novelty" }
    ];

    // ===== State =====
    let ideaIndex = 0;
    let pairIndex = 0;

    // Likert answers: { [ideaId]: { novelty:1..5, usefulness:..., ... } }
    const likertAnswers = Object.create(null);

    // Pairwise answers: { pairIndex: "A"|"B"|"TIE" }
    const pairwiseAnswers = Object.create(null);

    // ===== Helpers =====
    function $(id){ return document.getElementById(id); }

    function renderLikertScale(container, ideaId, key){
      container.innerHTML = "";
      for(let v=1; v<=5; v++){
        const label = document.createElement("label");
        const input = document.createElement("input");
        input.type = "radio";
        input.name = `${ideaId}_${key}`;
        input.value = String(v);

        const current = likertAnswers[ideaId]?.[key];
        if(current === v) input.checked = true;

        input.addEventListener("change", () => {
          likertAnswers[ideaId] ||= {};
          likertAnswers[ideaId][key] = v;
        });

        label.appendChild(input);
        label.appendChild(document.createTextNode(String(v)));
        container.appendChild(label);
      }
    }

    function renderIdea(){
      const idea = IDEAS[ideaIndex];
      $("ideaId").textContent = idea.id;
      $("ideaIdx").textContent = String(ideaIndex + 1);
      $("ideaTotal").textContent = String(IDEAS.length);
      $("ideaText").textContent = idea.text;

      document.querySelectorAll(".scale").forEach(scale => {
        const key = scale.dataset.key;
        renderLikertScale(scale, idea.id, key);
      });
    }

    function renderPair(){
      const pair = PAIRS[pairIndex];
      const a = IDEAS.find(x => x.id === pair.aId);
      const b = IDEAS.find(x => x.id === pair.bId);

      $("pairA").textContent = a ? a.text : "(アイデアAが見つかりません)";
      $("pairB").textContent = b ? b.text : "(アイデアBが見つかりません)";
      $("pairIdx").textContent = String(pairIndex + 1);
      $("pairTotal").textContent = String(PAIRS.length);
    }

    // ===== Mode toggle (same page panel) =====
    const modeLabel = $("modeLabel");
    const toggleModeBtn = $("toggleModeBtn");
    const pairwisePanel = $("pairwisePanel");
    const rightHint = $("rightHint");

    function showLikert(){
      modeLabel.textContent = "リッカート評価";
      toggleModeBtn.textContent = "ペア比較へ";
      pairwisePanel.classList.add("hidden");
      rightHint.classList.remove("hidden");
    }

    function showPairwise(){
      modeLabel.textContent = "ペア比較";
      toggleModeBtn.textContent = "リッカート評価へ";
      rightHint.classList.add("hidden");
      pairwisePanel.classList.remove("hidden");
      renderPair();
    }

    toggleModeBtn.addEventListener("click", () => {
      const isPair = !pairwisePanel.classList.contains("hidden");
      isPair ? showLikert() : showPairwise();
    });

    $("backToLikertBtn").addEventListener("click", showLikert);

    // ===== Likert navigation =====
    $("prevIdeaBtn").addEventListener("click", () => {
      ideaIndex = Math.max(0, ideaIndex - 1);
      renderIdea();
    });

    $("nextIdeaBtn").addEventListener("click", () => {
      ideaIndex = Math.min(IDEAS.length - 1, ideaIndex + 1);
      renderIdea();
    });

    $("saveBtn").addEventListener("click", () => {
      // Demo only
      console.log("Likert answers:", likertAnswers);
      alert("保存しました（例）。");
    });

    // ===== Pairwise choices =====
    document.querySelectorAll("[data-choice]").forEach(btn => {
      btn.addEventListener("click", () => {
        const choice = btn.dataset.choice; // A / B / TIE
        pairwiseAnswers[pairIndex] = choice;

        if(pairIndex < PAIRS.length - 1){
          pairIndex++;
          renderPair();
        }else{
          console.log("Pairwise answers:", pairwiseAnswers);
          alert("ペア比較（例）は以上です。");
          showLikert();
        }
      });
    });

    // ===== Init =====
    renderIdea();
    showLikert();
  </script>
</body>
</html>
