<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Admin | Responses</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 20px; }
    .topbar { display:flex; gap:12px; align-items:center; flex-wrap:wrap; margin-bottom: 12px; }
    .pill { display:inline-block; padding: 6px 10px; border:1px solid #ddd; border-radius: 999px; font-size: 12px; background:#fafafa; }
    a.btn { display:inline-block; padding: 8px 12px; border:1px solid #ccc; border-radius: 10px; text-decoration:none; color:#111; background:#fff; }
    a.btn:hover { background:#f5f5f5; }
    table { width:100%; border-collapse: collapse; margin-top: 10px; }
    th, td { border: 1px solid #e5e5e5; padding: 8px; vertical-align: top; font-size: 12px; }
    th { background: #f7f7f7; position: sticky; top: 0; z-index: 1; }
    code, pre { white-space: pre-wrap; word-break: break-word; }
    .muted { color:#666; font-size: 12px; }
    .small { font-size: 11px; }
    .nowrap { white-space: nowrap; }
    .cell { max-width: 360px; }
  </style>
</head>
<body>
  <div class="topbar">
    <h1 style="margin:0;">Admin â€” Responses</h1>

    <span class="pill">Rows: {{ rows|length }}</span>

    {# pw comes from query string, keep it for download link #}
    <a class="btn" href="{{ url_for('admin_export_csv') }}?pw={{ request.args.get('pw','') }}">Download CSV</a>
    <a class="btn" href="{{ url_for('resume') }}">Back to App</a>
  </div>

  <p class="muted">
    Showing latest records from <code>responses_v2</code>. Use the CSV export for analysis.
  </p>

  {% if rows|length == 0 %}
    <p><strong>No responses yet.</strong></p>
  {% else %}
    <div style="overflow:auto; border:1px solid #eee; border-radius: 12px;">
      <table>
        <thead>
          <tr>
            <th class="nowrap">created_at</th>
            <th class="nowrap">user</th>
            <th class="nowrap">base</th>
            <th class="nowrap">phase</th>
            <th>base_desc</th>
            <th>descriptors</th>
            <th>keywords</th>
            <th>reason</th>
            <th>concept</th>
            <th class="nowrap">time(s)</th>
          </tr>
        </thead>
        <tbody>
          {% for r in rows %}
          <tr>
            <td class="nowrap small">{{ r["created_at"] }}</td>
            <td class="nowrap">
              <div><strong>{{ r["username"] }}</strong></div>
              <div class="muted small">#{{ r["user_id"] }}</div>
            </td>
            <td class="nowrap">{{ r["base_id"] }}</td>
            <td class="nowrap">{{ r["phase"] }}</td>

            <td class="cell"><pre>{{ r["base_desc"] or "" }}</pre></td>
            <td class="cell"><pre>{{ r["descriptors"] or "" }}</pre></td>
            <td class="cell"><pre>{{ r["keywords"] or "" }}</pre></td>
            <td class="cell"><pre>{{ r["reason"] or "" }}</pre></td>
            <td class="cell"><pre>{{ r["concept"] or "" }}</pre></td>

            <td class="nowrap">{{ r["time_spent_sec"] if r["time_spent_sec"] is not none else "" }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% endif %}
</body>
</html>
